/*! 
 Build based on gin-vue-admin 
 Time : 1678354544000 */
/* empty css             */import{E as a}from"./drawer.11294d2c.js";import"./overlay.257b737a.js";import{E as e,a as t}from"./tab-pane.c58dc99c.js";import{E as l}from"./dialog.fa5df2a0.js";import{E as r,a as o}from"./form-item.b18f90c3.js";/* empty css              */import{E as i}from"./radio.abe700d6.js";/* empty css               */import"./tag.0bb54889.js";import"./checkbox.bcafce17.js";import"./scrollbar.561042ca.js";import{E as u,a as d}from"./table-column.61571603.js";/* empty css                *//* empty css               */import{g as s,d as n,c as m,u as p,a as c}from"./authority.fe1b2d97.js";import y from"./menus.789cc842.js";import h from"./apis.b781d1ea.js";import v from"./datas.fb9a79c3.js";import{W as f}from"./warningBar.b44e96f3.js";import{r as b,o as I,c as g,e as j,d as w,w as k,a1 as _,f as C,h as N,c1 as V,j as x,E,b as A}from"./index.12a9298d.js";import"./strings.e4f34ae9.js";import"./refs.b0cb2972.js";import"./_Uint8Array.f5d85d65.js";import"./_initCloneObject.8371cae6.js";import"./rand.6d0d1e93.js";import"./isEqual.471ce309.js";import"./index.bf155b92.js";import"./index.f53077c2.js";import"./tree.19ffdddf.js";import"./index.b753be06.js";import"./authorityBtn.65dcb897.js";import"./api.4929e5d2.js";/* empty css             */const U={class:"authority"},q={class:"gva-table-box"},B={class:"gva-btn-list"},S=N("新增角色"),z=N("设置权限"),D=N("新增子角色"),R=N("拷贝"),F=N("编辑"),O=N("删除"),T={class:"dialog-footer"},P=N("取 消"),W=N("确 定"),$={name:"Authority"},G=Object.assign($,{setup(N){const $=b([{authorityId:0,authorityName:"根角色"}]),G=b(!1),H=b("add"),J=b({}),K=b("新增角色"),L=b(!1),M=b(!1),Q=b({}),X=b({authorityId:0,authorityName:"",parentId:0}),Y=b({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),Z=b(1),aa=b(0),ea=b(999),ta=b([]),la=b({}),ra=async()=>{const a=await s({page:Z.value,pageSize:ea.value,...la.value});0===a.code&&(ta.value=a.data.list,aa.value=a.data.total,Z.value=a.data.page,ea.value=a.data.pageSize)};ra();const oa=(a,e)=>{J.value[a]=e},ia=b(null),ua=b(null),da=b(null),sa=(a,e)=>{const t=[ia,ua,da];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},na=b(null),ma=()=>{na.value&&na.value.resetFields(),X.value={authorityId:0,authorityName:"",parentId:0}},pa=()=>{ma(),L.value=!1,M.value=!1},ca=()=>{if(X.value.authorityId=Number(X.value.authorityId),0===X.value.authorityId)return x({type:"error",message:"角色id不能为0"}),!1;na.value.validate((async a=>{if(a){switch(H.value){case"add":0===(await c(X.value)).code&&(x({type:"success",message:"添加成功!"}),ra(),pa());break;case"edit":0===(await p(X.value)).code&&(x({type:"success",message:"添加成功!"}),ra(),pa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=X.value.authorityId,a.authority.authorityName=X.value.authorityName,a.authority.parentId=X.value.parentId,a.authority.dataAuthorityId=Q.value.dataAuthorityId,a.oldAuthorityId=Q.value.authorityId;0===(await m(a)).code&&(x({type:"success",message:"复制成功！"}),ra())}}ma(),L.value=!1}}))},ya=()=>{$.value=[{authorityId:0,authorityName:"根角色"}],ha(ta.value,$.value,!1)},ha=(a,e,t)=>{X.value.authorityId=String(X.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId,children:[]};ha(a.children,l.children,t||a.authorityId===X.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId};e.push(l)}}))},va=a=>{ma(),K.value="新增角色",H.value="add",X.value.parentId=a,ya(),L.value=!0};return(s,m)=>{const p=E,c=u,b=d,N=i,M=r,aa=A,ea=o,la=l,ma=e,ha=t,fa=a;return I(),g("div",U,[j(f,{title:"注：右上角头像下拉可切换角色"}),w("div",q,[w("div",B,[j(p,{type:"primary",icon:"plus",onClick:m[0]||(m[0]=a=>va(0))},{default:k((()=>[S])),_:1})]),j(b,{data:ta.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:k((()=>[j(c,{label:"角色ID","min-width":"180",prop:"authorityId"}),j(c,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),j(c,{align:"left",label:"操作",width:"460"},{default:k((a=>[j(p,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,G.value=!0,void(J.value=t);var t}},{default:k((()=>[z])),_:2},1032,["onClick"]),j(p,{icon:"plus",type:"primary",link:"",onClick:e=>va(a.row.authorityId)},{default:k((()=>[D])),_:2},1032,["onClick"]),j(p,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{ya(),K.value="拷贝角色",H.value="copy";for(const e in X.value)X.value[e]=a[e];Q.value=a,L.value=!0})(a.row)},{default:k((()=>[R])),_:2},1032,["onClick"]),j(p,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ya(),K.value="编辑角色",H.value="edit";for(const e in X.value)X.value[e]=a[e];ya(),L.value=!0})(a.row)},{default:k((()=>[F])),_:2},1032,["onClick"]),j(p,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void V.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await n({authorityId:t.authorityId})).code&&(x({type:"success",message:"删除成功!"}),1===ta.value.length&&Z.value>1&&Z.value--,ra())})).catch((()=>{x({type:"info",message:"已取消删除"})}));var t}},{default:k((()=>[O])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),j(la,{modelValue:L.value,"onUpdate:modelValue":m[4]||(m[4]=a=>L.value=a),title:K.value},{footer:k((()=>[w("div",T,[j(p,{onClick:pa},{default:k((()=>[P])),_:1}),j(p,{type:"primary",onClick:ca},{default:k((()=>[W])),_:1})])])),default:k((()=>[j(ea,{ref_key:"authorityForm",ref:na,model:X.value,rules:Y.value,"label-width":"80px"},{default:k((()=>[j(M,{label:"父级角色",prop:"parentId"},{default:k((()=>[j(N,{modelValue:X.value.parentId,"onUpdate:modelValue":m[1]||(m[1]=a=>X.value.parentId=a),style:{width:"100%"},disabled:"add"===H.value,options:$.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),j(M,{label:"角色ID",prop:"authorityId"},{default:k((()=>[j(aa,{modelValue:X.value.authorityId,"onUpdate:modelValue":m[2]||(m[2]=a=>X.value.authorityId=a),disabled:"edit"===H.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),j(M,{label:"角色姓名",prop:"authorityName"},{default:k((()=>[j(aa,{modelValue:X.value.authorityName,"onUpdate:modelValue":m[3]||(m[3]=a=>X.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),G.value?(I(),_(fa,{key:0,modelValue:G.value,"onUpdate:modelValue":m[5]||(m[5]=a=>G.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:k((()=>[j(ha,{"before-leave":sa,type:"border-card"},{default:k((()=>[j(ma,{label:"角色菜单"},{default:k((()=>[j(y,{ref_key:"menus",ref:ia,row:J.value,onChangeRow:oa},null,8,["row"])])),_:1}),j(ma,{label:"角色api"},{default:k((()=>[j(h,{ref_key:"apis",ref:ua,row:J.value,onChangeRow:oa},null,8,["row"])])),_:1}),j(ma,{label:"资源权限"},{default:k((()=>[j(v,{ref_key:"datas",ref:da,authority:ta.value,row:J.value,onChangeRow:oa},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):C("",!0)])}}});export{G as default};
