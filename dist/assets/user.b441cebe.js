/*! 
 Build based on gin-vue-admin 
 Time : 1678354544000 */
/* empty css             */import{E as e}from"./dialog.fa5df2a0.js";import"./overlay.257b737a.js";import{E as a,a as l}from"./form-item.b18f90c3.js";/* empty css              */import{E as t}from"./pagination.e33d475f.js";import"./tag.0bb54889.js";import"./select.0319208d.js";import"./scrollbar.561042ca.js";/* empty css               */import{E as i,a as o}from"./table-column.61571603.js";import"./checkbox.bcafce17.js";/* empty css                */import{E as r}from"./popover.60f34cfa.js";import{E as s}from"./switch.1309e437.js";import{E as u}from"./radio.abe700d6.js";/* empty css               */import{r as d,D as n,o as m,c as p,e as c,d as v,w as g,a1 as h,f,h as b,cX as y,c1 as w,cY as I,j,cZ as V,c_ as k,c$ as _,W as C,d0 as N,E as x,b as U}from"./index.12a9298d.js";import{g as z}from"./authority.fe1b2d97.js";import{C as D}from"./index.13294f23.js";import{_ as E}from"./index.65749f6c.js";import{W as S}from"./warningBar.b44e96f3.js";import"./refs.b0cb2972.js";import"./_Uint8Array.f5d85d65.js";import"./_initCloneObject.8371cae6.js";import"./isEqual.471ce309.js";import"./index.bf155b92.js";import"./index.f53077c2.js";import"./strings.e4f34ae9.js";import"./dropdown.469739c6.js";import"./rand.6d0d1e93.js";import"./drawer.11294d2c.js";/* empty css             */import"./common.0cfb4872.js";import"./upload.f0d4bb90.js";import"./progress.ec06c490.js";const O={class:"gva-table-box"},q={class:"gva-btn-list"},J=b("新增用户"),T=v("p",null,"确定要删除此用户吗",-1),B={style:{"text-align":"right","margin-top":"8px"}},$=b("取消"),A=b("确定"),F=b("删除"),P=b("编辑"),R=b("重置密码"),W={class:"gva-pagination"},Z={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},X=["src"],Y={key:1,class:"header-img-box"},G={class:"dialog-footer"},H=b("取 消"),K=b("确 定"),L={name:"User"},M=Object.assign(L,{setup(b){const L=d("/api/"),M=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};M(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},Q=d(1),ee=d(0),ae=d(10),le=d([]),te=e=>{ae.value=e,oe()},ie=e=>{Q.value=e,oe()},oe=async()=>{const e=await y({page:Q.value,pageSize:ae.value});0===e.code&&(le.value=e.data.list,ee.value=e.data.total,Q.value=e.data.page,ae.value=e.data.pageSize)};n((()=>le.value),(()=>{re()}));(async()=>{oe();const e=await z({page:1,pageSize:999});ne(e.data.list)})();const re=()=>{le.value&&le.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},se=d(null),ue=()=>{se.value.open()},de=d([]),ne=e=>{de.value=[],M(e,de.value)},me=d({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),pe=d({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),ce=d(null),ve=async()=>{me.value.authorityId=me.value.authorityIds[0],ce.value.validate((async e=>{if(e){const e={...me.value};if("add"===fe.value){0===(await k(e)).code&&(j({type:"success",message:"创建成功"}),await oe(),he())}if("edit"===fe.value){0===(await _(e)).code&&(j({type:"success",message:"编辑成功"}),await oe(),he())}}}))},ge=d(!1),he=()=>{ce.value.resetFields(),me.value.headerImg="",me.value.authorityIds=[],ge.value=!1},fe=d("add"),be=()=>{fe.value="add",ge.value=!0},ye={},we=async(e,a,l)=>{if(a)return void(l||(ye[e.ID]=[...e.authorityIds]));await C();0===(await N({ID:e.ID,authorityIds:e.authorityIds})).code?j({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...ye[e.ID]],delete ye[e.ID])};return(d,n)=>{const b=x,y=i,k=u,N=s,z=r,M=o,re=t,ne=U,ye=a,Ie=l,je=e;return m(),p("div",null,[c(S,{title:"注：右上角头像下拉可切换角色"}),v("div",O,[v("div",q,[c(b,{type:"primary",icon:"plus",onClick:be},{default:g((()=>[J])),_:1})]),c(M,{data:le.value,"row-key":"ID"},{default:g((()=>[c(y,{align:"left",label:"头像","min-width":"75"},{default:g((e=>[c(D,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),c(y,{align:"left",label:"ID","min-width":"50",prop:"ID"}),c(y,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),c(y,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),c(y,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),c(y,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),c(y,{align:"left",label:"用户角色","min-width":"200"},{default:g((e=>[c(k,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:de.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{we(e.row,a,0)},onRemoveTag:a=>{we(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),c(y,{align:"left",label:"启用","min-width":"150"},{default:g((e=>[c(N,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{me.value=JSON.parse(JSON.stringify(e)),await C();const a={...me.value};0===(await _(a)).code&&(j({type:"success",message:(2===a.enable?"禁用":"启用")+"成功"}),await oe(),me.value.headerImg="",me.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),c(y,{label:"操作","min-width":"250",fixed:"right"},{default:g((e=>[c(z,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top",width:"160"},{reference:g((()=>[c(b,{type:"primary",link:"",icon:"delete"},{default:g((()=>[F])),_:1})])),default:g((()=>[T,v("div",B,[c(b,{type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:g((()=>[$])),_:2},1032,["onClick"]),c(b,{type:"primary",onClick:a=>(async e=>{0===(await V({id:e.ID})).code&&(j.success("删除成功"),e.visible=!1,await oe())})(e.row)},{default:g((()=>[A])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"]),c(b,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,fe.value="edit",me.value=JSON.parse(JSON.stringify(l)),void(ge.value=!0);var l}},{default:g((()=>[P])),_:2},1032,["onClick"]),c(b,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void w.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await I({ID:l.ID});0===e.code?j({type:"success",message:e.msg}):j({type:"error",message:e.msg})}));var l}},{default:g((()=>[R])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),v("div",W,[c(re,{"current-page":Q.value,"page-size":ae.value,"page-sizes":[10,30,50,100],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ie,onSizeChange:te},null,8,["current-page","page-size","total"])])]),c(je,{modelValue:ge.value,"onUpdate:modelValue":n[7]||(n[7]=e=>ge.value=e),"custom-class":"user-dialog",title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:g((()=>[v("div",G,[c(b,{onClick:he},{default:g((()=>[H])),_:1}),c(b,{type:"primary",onClick:ve},{default:g((()=>[K])),_:1})])])),default:g((()=>[v("div",Z,[c(Ie,{ref_key:"userForm",ref:ce,rules:pe.value,model:me.value,"label-width":"80px"},{default:g((()=>["add"===fe.value?(m(),h(ye,{key:0,label:"用户名",prop:"userName"},{default:g((()=>[c(ne,{modelValue:me.value.userName,"onUpdate:modelValue":n[0]||(n[0]=e=>me.value.userName=e)},null,8,["modelValue"])])),_:1})):f("",!0),"add"===fe.value?(m(),h(ye,{key:1,label:"密码",prop:"password"},{default:g((()=>[c(ne,{modelValue:me.value.password,"onUpdate:modelValue":n[1]||(n[1]=e=>me.value.password=e)},null,8,["modelValue"])])),_:1})):f("",!0),c(ye,{label:"昵称",prop:"nickName"},{default:g((()=>[c(ne,{modelValue:me.value.nickName,"onUpdate:modelValue":n[2]||(n[2]=e=>me.value.nickName=e)},null,8,["modelValue"])])),_:1}),c(ye,{label:"手机号",prop:"phone"},{default:g((()=>[c(ne,{modelValue:me.value.phone,"onUpdate:modelValue":n[3]||(n[3]=e=>me.value.phone=e)},null,8,["modelValue"])])),_:1}),c(ye,{label:"邮箱",prop:"email"},{default:g((()=>[c(ne,{modelValue:me.value.email,"onUpdate:modelValue":n[4]||(n[4]=e=>me.value.email=e)},null,8,["modelValue"])])),_:1}),c(ye,{label:"用户角色",prop:"authorityId"},{default:g((()=>[c(k,{modelValue:me.value.authorityIds,"onUpdate:modelValue":n[5]||(n[5]=e=>me.value.authorityIds=e),style:{width:"100%"},options:de.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),c(ye,{label:"启用",prop:"disabled"},{default:g((()=>[c(N,{modelValue:me.value.enable,"onUpdate:modelValue":n[6]||(n[6]=e=>me.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),c(ye,{label:"头像","label-width":"80px"},{default:g((()=>[v("div",{style:{display:"inline-block"},onClick:ue},[me.value.headerImg?(m(),p("img",{key:0,alt:"头像",class:"header-img-box",src:me.value.headerImg&&"http"!==me.value.headerImg.slice(0,4)?L.value+me.value.headerImg:me.value.headerImg},null,8,X)):(m(),p("div",Y,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),c(E,{ref_key:"chooseImg",ref:se,target:me.value,"target-key":"headerImg"},null,8,["target"])])}}});export{M as default};
